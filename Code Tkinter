
import tkinter as tk
import serial
import threading

# === Configuration port sÃ©rie ===
PORT = "COM5"  # â¬…ï¸ Change si nÃ©cessaire
BAUDRATE = 115200

# === FenÃªtre principale ===
root = tk.Tk()
root.title("ğŸ“Š Station MÃ©tÃ©o UCA")
root.geometry("400x250")
root.resizable(False, False)

# === Titres et Ã©tiquettes ===
title = tk.Label(root, text="Station MÃ©tÃ©o UCA", font=("Arial", 18, "bold"))
title.pack(pady=10)

temp_label = tk.Label(root, text="ğŸŒ¡ TempÃ©rature : -- Â°C", font=("Arial", 14))
temp_label.pack(pady=5)

hum_label = tk.Label(root, text="ğŸ’§ HumiditÃ©    : -- %", font=("Arial", 14))
hum_label.pack(pady=5)

lux_label = tk.Label(root, text="ğŸ’¡ LuminositÃ©  : -- lux", font=("Arial", 14))
lux_label.pack(pady=5)

status = tk.Label(root, text="ğŸ”„ En attente de donnÃ©es...", fg="gray")
status.pack(pady=10)

# === Fonction de lecture sÃ©rie ===
def lire_donnees():
    try:
        ser = serial.Serial(PORT, BAUDRATE, timeout=2)
        status.config(text=f"âœ… ConnectÃ© Ã  {PORT}", fg="green")

        while True:
            line = ser.readline().decode().strip()
            if line.startswith("T=") and "H=" in line and "L=" in line:
                try:
                    valeurs = line.split(";")
                    temp = valeurs[0].split("=")[1]
                    hum = valeurs[1].split("=")[1]
                    lux = valeurs[2].split("=")[1]

                    temp_label.config(text=f"ğŸŒ¡ TempÃ©rature : {temp} Â°C")
                    hum_label.config(text=f"ğŸ’§ HumiditÃ©    : {hum} %")
                    lux_label.config(text=f"ğŸ’¡ LuminositÃ©  : {lux} lux")
                except:
                    status.config(text="âš ï¸ Format de ligne incorrect", fg="red")
    except serial.SerialException:
        status.config(text=f"âŒ Impossible dâ€™ouvrir {PORT}", fg="red")

# === Lancement dans un thread parallÃ¨le (Ã©vite blocage GUI) ===
thread = threading.Thread(target=lire_donnees)
thread.daemon = True
thread.start()

# === Boucle principale ===
root.mainloop()
